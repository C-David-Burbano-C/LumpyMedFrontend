<h2 mat-dialog-title class="text-xl font-bold text-gray-800">
  {{ (isEditMode ? 'MEDICINES.EDIT' : 'MEDICINES.ADD') | translate }}
</h2>

<mat-dialog-content class="!pt-4">
  <form [formGroup]="medicineForm">
    <div class="space-y-4">
      <mat-form-field class="w-full" appearance="outline">
        <mat-label>{{ 'MEDICINES.NAME' | translate }}</mat-label>
        <input matInput formControlName="name" type="text">
        <mat-error *ngIf="f['name'].errors?.['required']">
          {{ 'VALIDATION.REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field class="w-full" appearance="outline">
        <mat-label>{{ 'MEDICINES.DESCRIPTION' | translate }}</mat-label>
        <textarea matInput formControlName="description" rows="3"></textarea>
        <mat-error *ngIf="f['description'].errors?.['required']">
          {{ 'VALIDATION.REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>

      <div class="grid grid-cols-2 gap-4">
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{ 'MEDICINES.MG_KG_DAY' | translate }}</mat-label>
          <input matInput formControlName="mgKgDay" type="number" step="0.1">
          <mat-error *ngIf="f['mgKgDay'].errors?.['required']">
            {{ 'VALIDATION.REQUIRED' | translate }}
          </mat-error>
          <mat-error *ngIf="f['mgKgDay'].errors?.['min']">
            {{ 'VALIDATION.MIN' | translate: {value: 0} }}
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{ 'MEDICINES.DOSES_PER_DAY' | translate }}</mat-label>
          <input matInput formControlName="dosesPerDay" type="number">
          <mat-error *ngIf="f['dosesPerDay'].errors?.['required']">
            {{ 'VALIDATION.REQUIRED' | translate }}
          </mat-error>
          <mat-error *ngIf="f['dosesPerDay'].errors?.['min']">
            {{ 'VALIDATION.MIN' | translate: {value: 1} }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{ 'MEDICINES.CONCENTRATION_MG' | translate }}</mat-label>
          <input matInput formControlName="concentrationMg" type="number" step="0.1">
          <mat-error *ngIf="f['concentrationMg'].errors?.['required']">
            {{ 'VALIDATION.REQUIRED' | translate }}
          </mat-error>
          <mat-error *ngIf="f['concentrationMg'].errors?.['min']">
            {{ 'VALIDATION.MIN' | translate: {value: 0} }}
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{ 'MEDICINES.CONCENTRATION_ML' | translate }}</mat-label>
          <input matInput formControlName="concentrationMl" type="number" step="0.1">
          <mat-error *ngIf="f['concentrationMl'].errors?.['required']">
            {{ 'VALIDATION.REQUIRED' | translate }}
          </mat-error>
          <mat-error *ngIf="f['concentrationMl'].errors?.['min']">
            {{ 'VALIDATION.MIN' | translate: {value: 0} }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{ 'MEDICINES.MIN_SAFE_ML' | translate }}</mat-label>
          <input matInput formControlName="minSafeMl" type="number" step="0.1">
          <mat-error *ngIf="f['minSafeMl'].errors?.['required']">
            {{ 'VALIDATION.REQUIRED' | translate }}
          </mat-error>
          <mat-error *ngIf="f['minSafeMl'].errors?.['min']">
            {{ 'VALIDATION.MIN' | translate: {value: 0} }}
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full" appearance="outline">
          <mat-label>{{ 'MEDICINES.MAX_SAFE_ML' | translate }}</mat-label>
          <input matInput formControlName="maxSafeMl" type="number" step="0.1">
          <mat-error *ngIf="f['maxSafeMl'].errors?.['required']">
            {{ 'VALIDATION.REQUIRED' | translate }}
          </mat-error>
          <mat-error *ngIf="f['maxSafeMl'].errors?.['min']">
            {{ 'VALIDATION.MIN' | translate: {value: 0} }}
          </mat-error>
        </mat-form-field>
      </div>

      <div *ngIf="errorMessage" class="alert-danger">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          <span>{{ errorMessage }}</span>
        </div>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions class="!flex !justify-end !gap-2 !pt-4">
  <button mat-button (click)="onCancel()" [disabled]="loading">
    {{ 'COMMON.CANCEL' | translate }}
  </button>
  <button mat-raised-button color="primary" (click)="onSubmit()" 
          [disabled]="loading || medicineForm.invalid">
    <span *ngIf="!loading">{{ 'COMMON.SAVE' | translate }}</span>
    <span *ngIf="loading" class="flex items-center">
      <span class="spinner mr-2"></span>
      {{ 'COMMON.LOADING' | translate }}
    </span>
  </button>
</mat-dialog-actions>
